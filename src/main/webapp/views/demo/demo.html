<!DOCTYPE html>
<html lang="en-us">
<head>
<title>设备管理界面</title>
<meta name="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../assets/bootstrap/css/bootstrap.css">
<link rel="stylesheet" href="../../assets/bootstrap-table/src/bootstrap-table.css">
<script src="../../assets/jquery/jquery-3.3.1.min.js"></script>
<script src="../../assets/bootstrap/js/bootstrap.min.js"></script>
<script src="../../assets/bootstrap-table/src/bootstrap-table.js"></script>
<script src="../../assets/bootstrap-table/src/tableExport.js"></script>
<script src="../../assets/bootstrap-table/src/locale/bootstrap-table-zh-CN.js"></script>
<script src="../../assets/iot/js/config.js?v=1.0.0"></script>
<script src="../../assets/iot/js/api.js?v=1.0.0"></script>
<script src="../../assets/iot/js/iot.js?v=1.0.0"></script>
<script src="../../assets/iot/js/device.js?v=1.0.0"></script>
<script src="../../assets/iot/js/modbus.js?v=1.0.0"></script>

<style type="text/css">
.page-header {
	padding-bottom: 1px;
	margin: 20px 5px 1px;
	border-bottom: 1px solid #eee;
}
</style>
</head>
<body>
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="detailModal" tabindex="-1" role="dialog"
		aria-labelledby="detailModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="detailModalLabel">模态框（Modal）标题</h4>
				</div>
				<div class="modal-body row">
					<div class="col-xs-6">
						<div class="input-group">
							<span class="input-group-addon">设备ID&nbsp;&nbsp;&nbsp;&nbsp;</span>
							<input type="text" id="device_Id" class="form-control" placeholder="请输入设备ID"
								style="width:178px;height:40px" name="username">
						</div>
						<br>
						<div class="input-group">
							<span class="input-group-addon">设备类型</span>
							<input type="text" id="device_ownerType" class="form-control" placeholder="请输入设备类型"
								style="width:178px;height:40px">
						</div>
					</div>
					<div class="col-xs-6">
						<div class="input-group">
							<span class="input-group-addon">经度</span>
							<input type="text" id="device_longitude" class="form-control" placeholder="请输入精度"
								style="width:178px;height:40px">
						</div>
						<br>
						<div class="input-group">
							<span class="input-group-addon">纬度</span>
							<input type="text" id="device_latitude" class="form-control" placeholder="请输入纬度"
								style="width:178px;height:40px">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button id="btn_save" type="button" class="btn btn-primary">保存</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				</div>
			</div>
		</div>
	</div>

	<div class="container-fluid div_dev">
		<div class="page-header">
			<h3>
				设备基础信息维护
				<small>设备类型定义</small>
			</h3>
		</div>
		<div id="toolbar">
			<button class="btn btn-primary"
				onClick="$('#tableData').tableExport({ type: 'excel', escape: 'false' })">数据导出</button>
		</div>
		<table id="tableData" data-toolbar="#toolbar">
		</table>
	</div>
	<script>
		//初始化设备信息
		function initTableData() {
			var data = {
				"currIndex" : 1,
				"pageSize" : 30
			};
	
			$dev.selectByPage(data,
				function(ret) {
					var obj = ret.data;
					for (i in obj) {
						obj[i]['lastTime'] = $api.fromUnixtime(obj[i]['lastTime']);
					}
					//bootstrap-Table获取数据
					$('#tableData').bootstrapTable({
						data : obj,
						striped : true,
						pagination : true,
						pageNumber : 1,
						pageSize : 10,
						pageList : [ 10, 50, 100, 1000 ],
						search : true,
						columns : [
							{
								title : '序号',
								align : 'center',
								formatter : function(value, row, index) {
									return index + 1;
								}
							},
							{
								field : 'deviceId',
								title : '设备ID',
								align : 'center',
								visible : false,
								sortable : true
							},
							{
								field : 'deviceName',
								title : '设备名称',
								align : 'center',
								sortable : true
							},
							{
								field : 'deviceType',
								title : '设备类型',
								align : 'center',
								sortable : true
							},
							{
								field : 'ownerName',
								title : '所有者',
								align : 'center',
								sortable : true
							},
							{
								field : 'longitude',
								title : '精度',
								align : 'center',
								sortable : true
							},
							{
								field : 'latitude',
								title : '纬度',
								align : 'center',
								sortable : true
							},
							{
								field : 'position',
								title : '安装位置',
								align : 'center',
								valign : 'middle',
								sortable : true
							},
							{
								field : 'installer',
								title : '安装人',
								align : 'center',
								sortable : true
							},
							{
								field : 'isOnline',
								title : '是否在线',
								align : 'center',
								sortable : true,
								formatter : dataFormatterIsOnline
							},
							{
								field : 'lastTime',
								title : '心跳时间',
								align : 'center',
								valign : 'middle',
								sortable : true
							},
							{
								field : 'operate',
								title : '操作',
								align : 'center',
								formatter : operateFormatter
							} ],
						formatNoMatches : function() {
							return "没有相关的匹配结果";
						},
						formatLoadingMessage : function() {
							return "";
						}
					});
				},
				function() {
					alert('查询提示', '设备信息加载失败');
				});
		}
		function operateFormatter(value, row, index) {
			return [
				'<button type="button" class="btn btn-success  btn-sm" ',
				'style="margin-right:5px;" ',
				' onclick="showDetial(\'' + escape(JSON.stringify(row)) + '\')">设备详情</button>'
			].join('');
		}
		function dataFormatterIsOnline(value, row, index) {
			if (value) {
				return '是';
			} else {
				return '否';
			}
		}
	</script>
	<script type="text/javascript">
		$(function() {
			initTableData();
		});
	
		function showDetial(row) {
			var rowData = unescape(row);
			rowData = JSON.parse(rowData);
			$("#detailModalLabel").text('编辑设备：   ' + rowData.deviceName);
			$("#device_Id").val(rowData.deviceId);
			$("#device_ownerType").val(rowData.ownerType);
			$("#device_longitude").val(rowData.longitude);
			$("#device_latitude").val(rowData.latitude);
			$('#detailModal').modal('show');
		}
		$("#btn_save").click(function() {
			alert("click");
		})
	</script>
</body>
</html>
